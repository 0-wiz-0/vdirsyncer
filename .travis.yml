language: python
python: "2.7"
env:
    global:
        - IS_TRAVIS=true  # used by owncloud-testserver to install php
        - CFLAGS=-O0  # speed up lxml build
    matrix:
        - DAV_SERVER=radicale_filesystem REQUIREMENTS=release
        - DAV_SERVER=radicale_filesystem REQUIREMENTS=devel
        - DAV_SERVER=radicale_database REQUIREMENTS=release
        - DAV_SERVER=radicale_database REQUIREMENTS=devel
        - DAV_SERVER=owncloud REQUIREMENTS=release

install:
    - "./install-deps.sh"
    - "pip install coveralls"
script:
    - "coverage run --source=vdirsyncer/,tests/ --module pytest"
after_success:
    - "coverage report --show-missing"
    - "coveralls"

matrix:
    allow_failures:
        # radicale db storage is broken in 0.8
        - env: DAV_SERVER=radicale_database REQUIREMENTS=release
        - env: DAV_SERVER=owncloud REQUIREMENTS=release
